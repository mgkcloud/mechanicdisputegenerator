(()=>{var e={};e.id=86,e.ids=[86],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6426:(e,t,r)=>{"use strict";r.d(t,{DM:()=>a});let n=Symbol.for("__cloudflare-context__");function a(e={async:!1}){return e.async?s():function(){let e=o();if(e)return e;if(function(){let e=globalThis;return e.__NEXT_DATA__?.nextExport===!0}())throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error(u)}()}function o(){return globalThis[n]}async function s(){let e=o();if(e)return e;{let e=await i();return function(e){globalThis[n]=e}(e),e}}async function i(e){let{getPlatformProxy:t}=await import(`${"__wrangler".replaceAll("_","")}`),r=e?.environment??process.env.NEXT_DEV_WRANGLER_ENV,{env:n,cf:a,ctx:o}=await t({...e,environment:r});return{env:n,cf:a,ctx:o}}let u='\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n'+"   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n"},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32584:(e,t,r)=>{"use strict";r.d(t,{Rv:()=>o,hD:()=>n,hS:()=>a});class n extends Error{constructor(e,t=500,r=null){super(e),this.name="ApiError",this.statusCode=t,this.details=r}}function a(e){return(console.error("API Error:",e),e instanceof n)?{success:!1,error:e.message,details:e.details,statusCode:e.statusCode}:{success:!1,error:e.message||"An unexpected error occurred",statusCode:500}}function o(e,t){let r=t.filter(t=>!e[t]);if(r.length>0)throw new n(`Missing required fields: ${r.join(", ")}`,400,{missingFields:r})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63794:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>p,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>l});var a=r(96559),o=r(48088),s=r(37719),i=r(32190),u=r(71777),c=r(32584);async function l(e,t){try{let{fileName:r}=await t.params,{searchParams:n}=new URL(e.url),a="true"===n.get("download");if(!r)throw new c.hD("Filename is required",400);let o=await (0,u.YE)(r);if(!o)throw new c.hD("Document not found",404);let s={"Content-Type":"text/html"};return a&&(s["Content-Disposition"]=`attachment; filename="${r}.html"`),new i.NextResponse(o,{headers:s})}catch(t){let e=(0,c.hS)(t);return i.NextResponse.json(e,{status:e.statusCode})}}let d=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/documents/[fileName]/route",pathname:"/api/documents/[fileName]",filename:"route",bundlePath:"app/api/documents/[fileName]/route"},resolvedPagePath:"/Users/wlvar/Downloads/mechanicdisputecfworker (2)/app/api/documents/[fileName]/route.js",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:p}=d;function f(){return(0,s.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},71777:(e,t,r)=>{"use strict";r.d(t,{FN:()=>s,Pc:()=>u,YE:()=>i});var n=r(6426),a=r(55511);async function o(){try{return(await (0,n.DM)({async:!0})).env||{}}catch(e){return console.warn("Not running in Cloudflare Workers context, using process.env:",e.message),process.env}}async function s(e,t,r={}){let{contentType:n="text/html",metadata:i={},format:u="html"}=r,c=`${e}.${u}`;try{let r=await o(),s=r.DOCUMENTS_BUCKET;if(s)await s.put(c,t,{httpMetadata:{contentType:n,cacheControl:"public, max-age=31536000"},customMetadata:{...i,createdAt:new Date().toISOString()}});else{if(!r.S3_ACCESS_KEY||!r.S3_SECRET_KEY||!r.S3_BUCKET_NAME)throw Error("Missing required S3 environment variables");let e=r.S3_REGION||"us-east-1",o=r.S3_BUCKET_NAME,s=r.S3_ENDPOINT?r.S3_ENDPOINT.replace(/^https?:\/\//,""):`s3.${e}.amazonaws.com`,i=function(e){let{accessKey:t,secretKey:r,region:n,bucket:o,key:s,contentType:i,expires:u=3600,host:c,method:l="PUT"}=e,d=new Date,h=d.toISOString().replace(/[:-]|\.\d{3}/g,"").substring(0,8),m=d.toISOString().replace(/[:-]|\.\d{3}/g,"");d.getTime();let p={method:l,path:`/${s}`,query:{"X-Amz-Algorithm":"AWS4-HMAC-SHA256","X-Amz-Credential":`${t}/${h}/${n}/s3/aws4_request`,"X-Amz-Date":m.slice(0,16)+"Z","X-Amz-Expires":u.toString(),"X-Amz-SignedHeaders":"host"},headers:{host:c}};i&&(p.query["Content-Type"]=i);let f=Object.keys(p.query).sort().map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(p.query[e])}`).join("&"),E=[p.method,p.path,f,"host:"+p.headers.host+"\n","host","UNSIGNED-PAYLOAD"].join("\n"),g=["AWS4-HMAC-SHA256",p.query["X-Amz-Date"],`${h}/${n}/s3/aws4_request`,a.createHash("sha256").update(E).digest("hex")].join("\n"),w=function(e,t,r){let n=a.createHmac("sha256","AWS4"+e).update(t).digest(),o=a.createHmac("sha256",n).update(r).digest(),s=a.createHmac("sha256",o).update("s3").digest();return a.createHmac("sha256",s).update("aws4_request").digest()}(r,h,n),C=a.createHmac("sha256",w).update(g).digest("hex");p.query["X-Amz-Signature"]=C;let S=Object.keys(p.query).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(p.query[e])}`).join("&");return`https://${c}${p.path}?${S}`}({accessKey:r.S3_ACCESS_KEY,secretKey:r.S3_SECRET_KEY,region:e,bucket:o,key:`${o}/${c}`,contentType:n,host:s,method:"PUT"}),u=await fetch(i,{method:"PUT",headers:{"Content-Type":n,"Cache-Control":"public, max-age=31536000"},body:t});if(!u.ok)throw Error(`Failed to upload document: ${u.status} ${u.statusText}`)}return`/api/documents/${e}`}catch(e){throw console.error("Error storing document:",e),Error(`Failed to store document: ${e.message}`)}}async function i(e){try{let t=e.endsWith(".html")?e:`${e}.html`,r=await o(),n=r.DOCUMENTS_BUCKET;if(n){let e=await n.get(t);if(null===e)return null;return await e.text()}{if(!r.S3_ACCESS_KEY||!r.S3_SECRET_KEY||!r.S3_BUCKET_NAME)throw Error("Missing required S3 environment variables");let e=r.S3_REGION||"us-east-1",n=r.S3_BUCKET_NAME,a=r.S3_ENDPOINT||`https://s3.${e}.amazonaws.com`,o=`${a}/${n}/${t}`,s=await fetch(o);if(!s.ok){if(404===s.status)return null;throw Error(`Failed to get document: ${s.status} ${s.statusText}`)}return await s.text()}}catch(e){if("NoSuchKey"===e.name||"NotFound"===e.name||e.message.includes("404"))return null;throw console.error("Error retrieving document:",e),Error(`Failed to retrieve document: ${e.message}`)}}async function u(e){try{let t=await o(),r=t.DOCUMENTS_BUCKET;if(r){let t=await r.head(e);if(null===t)return null;return{contentType:t.httpMetadata?.contentType,metadata:t.customMetadata,lastModified:t.uploaded,contentLength:t.size}}{if(!t.S3_ACCESS_KEY||!t.S3_SECRET_KEY||!t.S3_BUCKET_NAME)throw Error("Missing required S3 environment variables");let r=t.S3_REGION||"us-east-1",n=t.S3_BUCKET_NAME,a=t.S3_ENDPOINT||`https://s3.${r}.amazonaws.com`,o=`${a}/${n}/${e}`,s=await fetch(o,{method:"HEAD"});if(!s.ok){if(404===s.status)return null;throw Error(`Failed to get document metadata: ${s.status} ${s.statusText}`)}return{contentType:s.headers.get("Content-Type"),contentLength:parseInt(s.headers.get("Content-Length")||"0"),lastModified:new Date(s.headers.get("Last-Modified")),metadata:{}}}}catch(e){if("NotFound"===e.name||"NoSuchKey"===e.name||e.message.includes("404"))return null;throw console.error("Error retrieving document metadata:",e),Error(`Failed to retrieve document metadata: ${e.message}`)}}},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,580],()=>r(63794));module.exports=n})();