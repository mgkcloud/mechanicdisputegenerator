(()=>{var e={};e.id=163,e.ids=[163],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7772:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>h,serverHooks:()=>f,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{GET:()=>l});var s=r(96559),n=r(48088),a=r(37719),i=r(32190),p=r(91043);let c=void 0!==global.DOCUMENTS_BUCKET,u=c?null:new p.S3Client({region:process.env.S3_REGION||"auto",endpoint:process.env.S3_ENDPOINT,credentials:{accessKeyId:process.env.S3_ACCESS_KEY||"",secretAccessKey:process.env.S3_SECRET_KEY||""}}),d=process.env.S3_BUCKET_NAME||"mechanic-dispute-documents";async function l(e,{params:t}){try{let e,r,o;let{caseId:s,photoId:n}=await t;if(!s||!n)return i.NextResponse.json({error:"Missing case ID or photo ID"},{status:400});if(c){let t=`${s}/${n}`,a=await global.DOCUMENTS_BUCKET.list({prefix:t});if(!a||!a.objects||0===a.objects.length)return i.NextResponse.json({error:"Photo not found"},{status:404});e=a.objects[0].key;let p=await global.DOCUMENTS_BUCKET.get(e);if(null===p)return i.NextResponse.json({error:"Photo not found"},{status:404});r=await p.arrayBuffer(),o=p.httpMetadata?.contentType||"image/jpeg"}else try{let t=null;for(let r of["jpg","jpeg","png","pdf","doc","docx"])try{if(e=`${s}/${n}.${r}`,t=await u.send(new p.GetObjectCommand({Bucket:d,Key:e})))break}catch(e){continue}if(!t)throw Error("File not found with any common extension");let a=[];for await(let e of t.Body)a.push(e);r=Buffer.concat(a),o=t.ContentType||"image/jpeg"}catch(e){return i.NextResponse.json({error:"Photo not found"},{status:404})}return new i.NextResponse(r,{headers:{"Content-Type":o,"Cache-Control":"public, max-age=31536000"}})}catch(e){return console.error("Error retrieving photo:",e),i.NextResponse.json({error:"Error retrieving photo: "+e.message},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/get-photo/[caseId]/[photoId]/route",pathname:"/api/get-photo/[caseId]/[photoId]",filename:"route",bundlePath:"app/api/get-photo/[caseId]/[photoId]/route"},resolvedPagePath:"/Users/wlvar/Downloads/mechanicdisputecfworker (2)/app/api/get-photo/[caseId]/[photoId]/route.js",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:x,serverHooks:f}=h;function v(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},91043:e=>{"use strict";e.exports=require("@aws-sdk/client-s3")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[447,580],()=>r(7772));module.exports=o})();