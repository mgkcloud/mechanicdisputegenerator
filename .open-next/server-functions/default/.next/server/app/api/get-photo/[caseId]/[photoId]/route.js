(()=>{var e={};e.id=163,e.ids=[163],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6426:(e,t,n)=>{"use strict";n.d(t,{DM:()=>r});let o=Symbol.for("__cloudflare-context__");function r(e={async:!1}){return e.async?s():function(){let e=a();if(e)return e;if(function(){let e=globalThis;return e.__NEXT_DATA__?.nextExport===!0}())throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error(l)}()}function a(){return globalThis[o]}async function s(){let e=a();if(e)return e;{let e=await i();return function(e){globalThis[o]=e}(e),e}}async function i(e){let{getPlatformProxy:t}=await import(`${"__wrangler".replaceAll("_","")}`),n=e?.environment??process.env.NEXT_DEV_WRANGLER_ENV,{env:o,cf:r,ctx:a}=await t({...e,environment:n});return{env:o,cf:r,ctx:a}}let l='\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n'+"   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n"},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72644:(e,t,n)=>{"use strict";n.r(t),n.d(t,{patchFetch:()=>x,routeModule:()=>g,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var o={};n.r(o),n.d(o,{GET:()=>p});var r=n(96559),a=n(48088),s=n(37719),i=n(32190),l=n(6426);async function c(e,t,n){console.log(`Using R2 binding to get file with prefix ${e}/${t}`);let o=`${e}/${t}`,r=await n.list({prefix:o});if(!r||!r.objects||0===r.objects.length)return null;let a=r.objects[0].key;console.log(`Found file: ${a}`);let s=await n.get(a);return null===s?null:{fileData:await s.arrayBuffer(),contentType:s.httpMetadata?.contentType||"image/jpeg",fileName:a}}async function u(e,t,n){if(console.log("Using HTTP to get file from S3/R2"),!n.S3_ENDPOINT||!n.S3_BUCKET_NAME)throw Error("Missing required S3 environment variables");let o=n.S3_ENDPOINT.replace(/\/$/,""),r=n.S3_BUCKET_NAME;for(let n of["jpg","jpeg","png","pdf","doc","docx"])try{let a=`${e}/${t}.${n}`;console.log(`Trying to get file: ${a}`);let s=`${o}/${r}/${a}`;console.log(`Trying URL: ${s}`);let i=await fetch(s);if(i.ok){let e=await i.arrayBuffer(),t=i.headers.get("Content-Type")||"image/jpeg";return{fileData:e,contentType:t,fileName:a}}}catch(e){console.error(`Error trying extension ${n}:`,e);continue}try{let n=`${e}/${t}`;for(let e of(console.log(`Trying prefix match: ${n}`),[`${n}.jpg`,`${n}.jpeg`,`${n}.png`,`${n}_*.jpg`,`${n}_*.jpeg`,`${n}_*.png`]))try{let t=`${o}/${r}/${e}`;console.log(`Trying pattern URL: ${t}`);let n=await fetch(t);if(n.ok){let t=await n.arrayBuffer(),o=n.headers.get("Content-Type")||"image/jpeg";return{fileData:t,contentType:o,pattern:e}}}catch(e){continue}}catch(e){console.error("Error trying prefix patterns:",e)}return null}async function p(e,{params:t}){let{caseId:n,photoId:o}=t;try{if(!n||!o)return i.NextResponse.json({error:"Missing case ID or photo ID"},{status:400});let e={},t=null;try{t=(e=(await (0,l.DM)({async:!0})).env||{}).DOCUMENTS_BUCKET,console.log("Available environment variables:",Object.keys(e).filter(e=>!e.includes("KEY")))}catch(t){console.log("Not running in Cloudflare Workers context, using process.env:",t.message),e=process.env}let r=null;if(t&&(console.log("R2 bucket binding found, trying that first"),r=await c(n,o,t)),!r&&e.S3_ENDPOINT&&(console.log("Falling back to HTTP retrieval"),r=await u(n,o,e)),!r)return console.log("Photo not found with any method"),i.NextResponse.json({error:"Photo not found"},{status:404});return new i.NextResponse(r.fileData,{headers:{"Content-Type":r.contentType,"Cache-Control":"public, max-age=31536000"}})}catch(e){return console.error("Error retrieving photo:",e),i.NextResponse.json({error:"Error retrieving photo: "+e.message},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/get-photo/[caseId]/[photoId]/route",pathname:"/api/get-photo/[caseId]/[photoId]",filename:"route",bundlePath:"app/api/get-photo/[caseId]/[photoId]/route"},resolvedPagePath:"/Users/wlvar/Downloads/mechanicdisputecfworker (2)/app/api/get-photo/[caseId]/[photoId]/route.js",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:h}=g;function x(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},78335:()=>{},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[447,580],()=>n(72644));module.exports=o})();